<h2 class="mb-4">Panel de Administración</h2>

<div *ngIf="feedbackMessage" class="alert alert-info">{{ feedbackMessage }}</div>

<h3 class="mb-3">Estadísticas de Solicitudes</h3>
<div class="row mb-5">
    <div *ngFor="let status of allStatuses" class="col-md-3 col-sm-6 mb-3">
        <div class="card text-white text-center shadow-sm" [ngClass]="getStatusClass(status)">
            <div class="card-body">
                <h5 class="card-title">{{ status }}</h5>
                <p class="card-text fs-2">{{ statusCounts[status] || 0 }}</p> 
            </div>
        </div>
    </div>
</div>

<h3 class="mb-3">Gráfico de Conteo por Estado</h3>
<div class="card shadow-sm mb-5">
    <div class="card-body">
        <canvas #statsChart></canvas> 
    </div>
</div>

<h3 class="mb-3">Listado General</h3>

<div class="mb-3 d-flex align-items-center">
    <label for="filterStatus" class="form-label me-3 mb-0">Filtrar por Estado:</label>
    <select class="form-select w-auto" id="filterStatus" [(ngModel)]="filterStatus" name="filterStatus">
        <option value="">Mostrar Todos</option>
        <option *ngFor="let status of allStatuses" [value]="status">{{ status }}</option>
    </select>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Estado</th>
                <th>Cliente</th>
                <th>Título</th>
                <th>Soporte Asignado (ID)</th>
                <th>Respuesta</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let req of filteredRequests"> 
                <td>{{ req.id }}</td>
                <td><span class="badge" [ngClass]="getStatusClass(req.status)">{{ req.status }}</span></td>
                <td>{{ req.client_name }}</td>
                <td>{{ req.title }}</td>
                <td>{{ req.support_name || 'N/A' }}</td>
                <td>{{ req.support_response || 'Pendiente' }}</td>
            </tr>
            <tr *ngIf="filteredRequests.length === 0">
                <td colspan="6" class="text-center">No hay solicitudes que coincidan con el filtro.</td>
            </tr>
        </tbody>
    </table>
</div>
